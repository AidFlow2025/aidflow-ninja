<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Ninja</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

  <header class="user-header">
  <h1>🥷 Bienvenido, <span id="ninja-name"></span></h1>
</header>

<!-- PROTECCIÓN -->
<script src="../js/auth.js"></script>
<script>
  protegerRuta("user");
</script>

<main class="container">

  <h1>🥷 Panel del Ninja</h1>

  <!-- PROGRESO -->
  <section class="card glow">
    <h2>⚔️ Progreso</h2>

    <div class="progress-bar">
      <div class="progress-fill" id="progreso-nivel1"></div>
    </div>

    <p id="info-nivel1">Tramos completados: 0 / 4</p>
  </section>

  <!-- ECONOMÍA -->
  <section class="card">
    <h2>💰 Economía</h2>

    <p id="shuriken-nivel1">Shuriken: 0</p>
    <p>Saldo: <strong id="saldo-usuario">$0.00</strong></p>

    <button class="btn primary" id="btn-retiro" onclick="retirarFondos()" disabled>
      Retirar fondos
    </button>

    <p style="opacity:.7;font-size:.9rem">
      🔒 Retiros habilitados por tramos completados.
    </p>
  </section>

  <section class="card">
  <h2>💰 Tu Wallet</h2>
  <p class="saldo">$<span id="wallet-saldo">0</span></p>
</section>

<button class="btn primary" onclick="pagarEntrada(10)">
  🥷 Entrar al Dojo ($10)
</button>

  <!-- DISCLAIMER LEGAL -->
<div class="card alert">
  <p>
    ⚠️ <strong>Aviso importante:</strong><br><br>

    AidFlow Ninja es una plataforma de participación gamificada.
    Los aportes realizados <strong>no constituyen inversión</strong>,
    <strong>no garantizan ganancias</strong> ni retornos económicos.

    <br><br>

    La participación es voluntaria y bajo responsabilidad del usuario.
  </p>

  <label class="terminos-check">
    <input type="checkbox" id="aceptaDisclaimer">
    Entiendo y acepto este aviso
  </label>
</div>

<label class="terminos-check">
  <input type="checkbox" id="aceptaDisclaimer">
  Entiendo y acepto el aviso legal para operaciones económicas
</label>



  <!-- REFERIDOS -->
  <section class="card">
    <h2>👥 Referidos</h2>

    <p>Total de referidos: <strong id="total-referidos">0</strong></p>

    <label>
      Tu link de referido:
      <input type="text" id="link-referido" readonly>
    </label>

    <button class="btn secondary" onclick="copiarReferido()">
      Copiar enlace
    </button>
  </section>

  <!-- JUEGOS -->
  <section class="card">
    <h2>🎮 Juegos Ninja</h2>
    <div id="juegos-container"></div>
  </section>

  <!-- TORNEOS -->
  <section class="card">
    <h2>🏆 Torneos</h2>
    <p id="torneos-status">
      🔒 Torneos se habilitan con 100 usuarios activos.
    </p>
    <button class="btn secondary" disabled>
      Entrenamiento
    </button>
  </section>

  <!-- RANKING -->
  <section class="card">
    <h2>📊 Ranking (Duelos)</h2>
    <ul id="ranking-list"></ul>
  </section>

  <!-- HISTORIAL -->
  <section class="card">
    <h2>📜 Historial</h2>
    <p>Ciclos completados: <strong id="hist-ciclos">0</strong></p>
    <p>Total ganado: <strong id="hist-total">$0.00</strong></p>
    <p>Shuriken ganados: <strong id="hist-shuriken">0</strong></p>
    <p>Último ciclo: <strong id="hist-fecha">—</strong></p>
  </section>

  <!-- RECOMPRA -->
  <button class="btn secondary" id="btn-recompra" style="display:none"
          onclick="recomprarPaseNinja()">
    🔁 Recomprar Pase Ninja
  </button>

  <button class="btn danger" onclick="logout()">Cerrar sesión</button>

</main>

<footer class="footer">
  <p>© 2025 AidFlow Ninja</p>
</footer>

<!-- SCRIPTS -->
<script src="../js/economia.js"></script>
<script src="../js/ui.js"></script>
<script src="../js/main.js"></script>

<script>
/* ======================
   REFERIDOS
====================== */
function cargarReferidos() {
  const user = localStorage.getItem("aidflow_user") || "ninja";
  const refCount =
    Number(localStorage.getItem("aidflow_refs_" + user)) || 0;

  document.getElementById("total-referidos").textContent = refCount;

  const link = `${location.origin}/register.html?ref=${user}`;
  document.getElementById("link-referido").value = link;
}

function copiarReferido() {
  const input = document.getElementById("link-referido");
  input.select();
  document.execCommand("copy");
  alert("Link copiado 🥷");
}

/* ======================
   JUEGOS EMBED
====================== */
function cargarJuegosUsuario() {
  const juegos =
    JSON.parse(localStorage.getItem("aidflow_juegos")) || [];

  const container = document.getElementById("juegos-container");
  container.innerHTML = "";

  juegos
    .filter(j => j.activo)
    .forEach(j => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <h3>${j.nombre}</h3>
        <iframe
          src="${j.url}"
          width="100%"
          height="300"
          frameborder="0"
          allowfullscreen>
        </iframe>
      `;
      container.appendChild(div);
    });

  if (!container.innerHTML) {
    container.innerHTML = "<p>⏳ Juegos disponibles próximamente.</p>";
  }
}

document.addEventListener("DOMContentLoaded", () => {
  cargarReferidos();
  cargarJuegosUsuario();
});
</script>

</body>
</html>
